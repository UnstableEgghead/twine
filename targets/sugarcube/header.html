<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>SugarCube</title>
<!--

SugarCube (build: 1913), a header for Twine/Twee
Copyright (c) 2013 Thomas Michael Edwards.

Credits: barabbas and Napdragon, for their support

-->
<script type="text/javascript">
/*
Portions of this code are based on:
____

TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license

Copyright (c) Osmosoft Limited 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list
of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or
other materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may
be used to endorse or promote products derived from this software without
specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
;(function () {"undefined"===typeof document||"classList"in document.createElement("a")||function(a){if("HTMLElement"in a||"Element"in a){a=(a.HTMLElement||a.Element).prototype;var b=Object,c=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},d=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},e=function(a,b){this.name=a;this.code=DOMException[a];this.message=b},f=function(a,b){if(""===b)throw new e("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new e("INVALID_CHARACTER_ERR","String contains an invalid character");return d.call(a,b)},g=function(a){for(var b=c.call(a.className),b=b?b.split(/\s+/):[],d=0,e=b.length;d<e;d++)this.push(b[d]);this._updateClassName=function(){a.className=this.toString()}},h=g.prototype=[],k=function(){return new g(this)};e.prototype=Error.prototype;h.item=function(a){return this[a]||null};h.contains=function(a){return-1!==f(this,a+"")};h.add=function(){var a=arguments,b=0,c=a.length,d,e=!1;do d=a[b]+"",-1===f(this,d)&&(this.push(d),e=!0);while(++b<c);e&&this._updateClassName()};h.remove=function(){var a=arguments,b=0,c=a.length,d,e=!1;do d=a[b]+"",d=f(this,d),-1!==d&&(this.splice(d,1),e=!0);while(++b<c);e&&this._updateClassName()};h.toggle=function(a,b){a+="";var c=this.contains(a),d=c?!0!==b&&"remove":!1!==b&&"add";if(d)this[d](a);return!c};h.toString=function(){return this.join(" ")};if(b.defineProperty){h={get:k,enumerable:!0,configurable:!0};try{b.defineProperty(a,"classList",h)}catch(l){-2146823252===l.number&&(h.enumerable=!1,b.defineProperty(a,"classList",h))}}else b.prototype.__defineGetter__&&a.__defineGetter__("classList",k)}}(window);(function(a){if(!("onhashchange"in a)){var b=a.location,c=b.href,d=b.hash;setInterval(function(){var e=b.href,f=b.hash;"function"===typeof a.onhashchange&&f!==d&&(a.onhashchange({type:"hashchange",oldURL:c,newURL:e}),c=e,d=f)},200)}})(window);Array.prototype.filter||(Array.prototype.filter=function(a,b){if(null==this||"function"!=typeof a)throw new TypeError;for(var c=Object(this),d=c.length>>>0,e=[],f=0;f<d;f++)if(f in c){var g=c[f];a.call(b,g,f,c)&&e.push(g)}return e});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){b||(b=0);for(var c=b,d=this.length;c<d;c++)if(this[c]===a)return c;return-1});Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});String.prototype.splice||(String.prototype.splice=function(a,b,c){return this.slice(0,a)+c+this.slice(a+Math.abs(b))});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.ltrim||(String.prototype.ltrim=function(){return this.replace(/^\s+/g,"")});String.prototype.rtrim||(String.prototype.rtrim=function(){return this.replace(/\s+$/g,"")});Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw Error("Object.create (polyfill) implementation only accepts one parameter.");a.prototype=b;return new a}}());var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(a){var b=a.document,c=a.URL||a.webkitURL||a,d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null);c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,k=function(b){(a.setImmediate||a.setTimeout)(function(){throw b;},0)},l=0,n=[],p=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"===typeof e)try{e.call(a,c||a)}catch(f){k(f)}}},r=function(b,c){var k=this,m=b.type,r=!1,t,v,y=function(){var c=(a.URL||a.webkitURL||a).createObjectURL(b);n.push(c);return c},z=function(){p(k,["writestart","progress","write","writeend"])},s=function(){if(r||!t)t=y(b);v?v.location.href=t:window.open(t,"_blank");k.readyState=k.DONE;z()},u=function(a){return function(){if(k.readyState!==k.DONE)return a.apply(this,arguments)}},A={create:!0,exclusive:!1},B;k.readyState=k.INIT;c||(c="download");if(e)t=y(b),d.href=t,d.download=c,f(d),k.readyState=k.DONE,z();else{a.chrome&&(m&&"application/octet-stream"!==m)&&(B=b.slice||b.webkitSlice,b=B.call(b,0,b.size,"application/octet-stream"),r=!0);g&&"download"!==c&&(c+=".download");if("application/octet-stream"===m||g)v=a;h?(l+=b.size,h(a.TEMPORARY,l,u(function(a){a.root.getDirectory("saved",A,u(function(a){var d=function(){a.getFile(c,A,u(function(a){a.createWriter(u(function(c){c.onwriteend=function(b){v.location.href=a.toURL();n.push(a);k.readyState=k.DONE;p(k,"writeend",b)};c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&s()};["writestart","progress","write","abort"].forEach(function(a){c["on"+a]=k["on"+a]});c.write(b);k.abort=function(){c.abort();k.readyState=k.DONE};k.readyState=k.WRITING}),s)}),s)};a.getFile(c,{create:!1},u(function(a){a.remove();d()}),u(function(a){a.code===a.NOT_FOUND_ERR?d():s()}))}),s)}),s)):s()}},m=r.prototype;m.abort=function(){this.readyState=this.DONE;p(this,"abort")};m.readyState=m.INIT=0;m.WRITING=1;m.DONE=2;m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null;a.addEventListener("unload",function(){for(var a=n.length;a--;){var b=n[a];"string"===typeof b?c.revokeObjectURL(b):b.remove()}n.length=0},!1);return function(a,b){return new r(a,b)}}(self);Math.easeInOut=function(a){return 1-(Math.cos(a*Math.PI)+1)/2};Math.clamp=function(a,b,c){a=Number(a);return isNaN(a)?NaN:a.clamp(b,c)};Number.prototype.clamp=function(a,b){var c=Number(this);c<a&&(c=a);c>b&&(c=b);return c};String.prototype.readBracketedList=function(){var a=/(?:\[\[((?:\s|\S)*?)\]\])|([^"'\s]\S*)/gm,b=[];do{var c=a.exec(this);c&&(c[1]?b.push(c[1]):c[2]&&b.push(c[2]))}while(c);return b};function isNumeric(a){return"number"===typeof a||!isNaN(parseFloat(a))&&isFinite(a)}function isBoolean(a){return"boolean"===typeof a||"string"===typeof a&&("true"===a||"false"===a)}function clone(a){var b={},c;for(c in a)b[c]=a[c];return b}function deepCopy(a){if(null===a||"object"!=typeof a)return a;if("function"==typeof a.clone)return a.clone(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return RegExp(a);if(a.nodeType&&"function"==typeof a.cloneNode)return a.cloneNode(!0);if(Array.isArray(a))for(var b=[],c=0;c<a.length;c++)b.push(deepCopy(a[c]));else for(c in b=Object.getPrototypeOf?Object.getPrototypeOf(a):a.__proto__,b||(b=a.constructor.prototype),b=Object.create(b),a)b[c]=deepCopy(a[c]);return b}function insertElement(a,b,c,d,e){b=document.createElement(b);c&&(b.id=c);d&&(b.className=d);e&&insertText(b,e);a&&a.appendChild(b);return b}function insertPassageLink(a,b,c,d){var e=document.createElement("a");e.className=tale.has(b)?"internalLink":"brokenLink";d&&(e.className+=" "+d);b&&e.setAttribute("data-passage",b);c&&insertText(e,c);a&&a.appendChild(e);return e}function insertText(a,b){return a.appendChild(document.createTextNode(b))}function removeChildren(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)}function setPageElement(a,b,c){if(a="object"===typeof a?a:document.getElementById(a))removeChildren(a),tale.has(b)?new Wikifier(a,tale.get(b).text):null!=c&&""!==c&&new Wikifier(a,c)}function addStyle(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.head.appendChild(b)}function throwError(a,b){insertElement(a,"span",null,"error","Error: "+b)}function fade(a,b){function c(a,b){var c=Math.floor(100*b);a.style.zoom=1;a.style.filter="alpha(opacity="+c+")";a.style.opacity=b}var d,e=a.cloneNode(!0),f="in"==b.fade?1:-1;a.parentNode.replaceChild(e,a);"in"==b.fade?(d=0,e.style.visibility="visible"):d=1;c(e,d);var g=window.setInterval(function(){d+=0.05*f;c(e,Math.easeInOut(d));if(1==f&&1<=d||-1==f&&0>=d)if(a.style.visibility="in"==b.fade?"visible":"hidden",e.parentNode.replaceChild(a,e),e=null,window.clearInterval(g),b.onComplete)b.onComplete()},25)}function scrollWindowTo(a){var b=window.scrollY?window.scrollY:document.body.scrollTop;a=function(a){var b;b=a;for(var c=0;b.offsetParent;)c+=b.offsetTop,b=b.offsetParent;b=c;var c=b+a.offsetHeight,d=window.scrollY?window.scrollY:document.body.scrollTop,e=window.innerHeight?window.innerHeight:document.body.clientHeight;return b<d?b:c>d+e?a.offsetHeight<e?b-(e-a.offsetHeight)+20:b:b}(a);var c=Math.abs(b-a),d=0,e=b>a?-1:1,f=window.setInterval(function(){d+=0.1;window.scrollTo(0,b+e*c*Math.easeInOut(d));1<=d&&window.clearInterval(f)},25)}function slugify(a){return a.trim().replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"_").toLocaleLowerCase()}function utf8ToBase64(a){return window.btoa(unescape(encodeURIComponent(a)))}function base64ToUtf8(a){return decodeURIComponent(escape(window.atob(a)))}function generateUuid(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===b?c:c&7|8).toString(16)})}function KeyValueStore(a,b){this.store=null;switch(a){case "cookie":this.name="cookie";break;case "localStorage":this.name=a;config.hasLocalStorage&&(this.store=window.localStorage);break;case "sessionStorage":this.name=a;config.hasSessionStorage&&(this.store=window.sessionStorage);break;default:throw Error("Unknown storage type.");}this.prefix=b+"."}KeyValueStore.prototype.setItem=function(a,b){if(!a)return!1;var c=a;a=this.prefix+a;b=JSON.stringify(b);if(this.store)try{this.store.setItem(a,b)}catch(d){return d==QUOTA_EXCEEDED_ERR&&window.alert("Unable to store key; "+this.name+" quota exceeded"),!1}else{var e=[escape(a)+"="+escape(b)];switch(this.name){case "cookie":case "localStorage":e.push("expires=Tue, 19 Jan 2038 03:14:07 GMT")}e.push("path=/");try{document.cookie=e.join("; ")}catch(f){return window.alert("Unable to store key; cookie error: "+f.message),!1}if(!this.hasItem(c))return window.alert("Unable to store key; unknown cookie error"),!1}return!0};KeyValueStore.prototype.getItem=function(a){if(!a)return null;a=this.prefix+a;if(this.store){if(this.store.getItem(a))return JSON.parse(this.store.getItem(a))}else{a=escape(a);for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0].trim()===a)return JSON.parse(unescape(d[1]))}}return null};KeyValueStore.prototype.removeItem=function(a){if(!a)return!1;a=this.prefix+a;this.store?this.store.removeItem(a):document.cookie=escape(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";return!0};KeyValueStore.prototype.removeMatchingItems=function(a){if(!a)return!1;var b=[],c=RegExp(("^"+this.prefix+a).replace(/\./g,"\\.")+".*");if(this.store)for(a=0;a<this.store.length;a++){var d=this.store.key(a);c.test(d)&&b.push(d)}else{escape(a);var e=document.cookie.split(";");for(a=0;a<e.length;a++)d=e[a].split("=")[0].trim(),c.test(d)&&b.push(d)}for(a=0;a<b.length;a++)this.removeItem(b[a]);return!0};KeyValueStore.prototype.hasItem=function(a){if(!a)return!1;a=this.prefix+a;if(this.store){if(this.store.getItem(a))return!0}else{a=escape(a);for(var b=document.cookie.split(";"),c=0;c<b.length;c++)if(b[c].split("=")[0].trim()==a)return!0}return!1};function getRandom(a,b){return Math.floor(Math.random()*(b-a+1))+a}function getRandomArbitrary(a,b){return Math.random()*(b-a)+a}var version={title:"SugarCube",major:1,minor:0,revision:0,date:new Date("August 13, 2013"),extensions:{}},modes={hashTag:1,windowHistory:2,sessionHistory:3},config={hasPushState:"history"in window&&"pushState"in window.history,hasLocalStorage:"localStorage"in window&&function(){try{return null!=window.localStorage&&0<=window.localStorage.length}catch(a){return!1}}(),hasSessionStorage:"sessionStorage"in window&&function(){try{return null!=window.sessionStorage&&0<=window.sessionStorage.length}catch(a){return!1}}(),hasFileAPI:window.File&&window.FileReader&&window.Blob,userAgent:navigator.userAgent.toLowerCase(),browser:{},displayPassageTitles:!1,historyMode:modes.hashTag,saves:{id:"untitled_story",isAllowed:void 0,onLoad:void 0,onSave:void 0,slots:8,version:void 0}};config.browser={isGecko:navigator&&"Gecko"===navigator.product&&-1===config.userAgent.indexOf("webkit"),isIE:-1!==config.userAgent.indexOf("msie")&&-1===config.userAgent.indexOf("opera"),ieVersion:function(){var a=/msie (\d{1,2}\.\d)/.exec(config.userAgent);return a?+a[1]:0}(),isOpera:-1!==config.userAgent.indexOf("opera")||-1!==config.userAgent.indexOf(" opr/"),operaVersion:function(){var a=RegExp((/applewebkit|chrome/.test(config.userAgent)?"opr":"version")+"\\/(\\d{1,2}\\.\\d+)").exec(config.userAgent);return a?+a[1]:0}()};config.historyMode=config.hasPushState?config.browser.isGecko?modes.sessionHistory:modes.windowHistory:modes.hashTag;var formatter=null,tale={},state={},macros={},storage={},session={},setup={};function main(){formatter=new WikiFormatter(Wikifier.formatters);tale=new Tale;storage=new KeyValueStore("localStorage",tale.domId);session=new KeyValueStore("sessionStorage",tale.domId);document.title=tale.title;config.saves.id=tale.domId;setPageElement("storyBanner","StoryBanner");setPageElement("storyTitle","StoryTitle",tale.title);setPageElement("storySubtitle","StorySubtitle");setPageElement("storyAuthor","StoryAuthor");tale.has("StoryCaption")&&(document.getElementById("storyCaption").style.display="block",setPageElement("storyCaption","StoryCaption"));tale.has("StoryMenu")&&(document.getElementById("storyMenu").style.display="block",setPageElement("storyMenu","StoryMenu"));if(tale.has("ShareMenu")){var a=document.getElementById("shareMenu");if(a){var b=tale.get("ShareMenu").text.trim();b&&(removeChildren(a),new Wikifier(a,b),a.innerHTML=a.innerHTML.replace(/(?:<br\s*\/?>)+/g,"\n"),a=document.getElementById("share"))&&(a.style.display="block")}}b=tale.lookup("tags","stylesheet");for(a=0;a<b.length;a++)addStyle(b[a].text);b=tale.lookup("tags","script");for(a=0;a<b.length;a++)try{eval(b[a].text)}catch(c){window.alert("There is a technical problem with this story ("+b[a].title+": "+c.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}b=tale.lookup("tags","widget");for(a=0;a<b.length;a++)try{var d=document.createElement("div");for(new Wikifier(d,b[a].text);d.hasChildNodes();){var e=d.firstChild;if(e.classList&&e.classList.contains("error"))throw Error(e.textContent);d.removeChild(e)}}catch(f){window.alert("There is a technical problem with this story ("+b[a].title+": "+f.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}state=new History;for(var g in macros)"function"===typeof macros[g].init&&macros[g].init(g);if(tale.has("StoryInit"))try{for(d=document.createElement("div"),new Wikifier(d,tale.get("StoryInit").text);d.hasChildNodes();){e=d.firstChild;if(e.classList&&e.classList.contains("error"))throw Error(e.textContent);d.removeChild(e)}}catch(h){window.alert("There is a technical problem with this story (StoryInit: "+h.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}state.init();for(g in macros)"function"===typeof macros[g].lateInit&&macros[g].lateInit(g);MenuSystem.init()}window.onload=main;var SaveSystem={maxIndex:0,init:function(a){storage.hasItem("saves")?a=storage.getItem("saves"):(a=Array(config.saves.slots),storage.setItem("saves",a));SaveSystem.maxIndex=a.length-1},save:function(a){if("function"===typeof config.saves.isAllowed&&!config.saves.isAllowed())return window.alert("Saving is not allowed here."),!1;if(0>a||a>SaveSystem.maxIndex||!storage.hasItem("saves"))return!1;var b=storage.getItem("saves");if(a>b.length)return!1;b[a]=SaveSystem.marshal();b[a].title=tale.get(state.active.title).excerpt();return storage.setItem("saves",b)},load:function(a){if(0>a||a>SaveSystem.maxIndex||!storage.hasItem("saves"))return!1;var b=storage.getItem("saves");return a>b.length||null===b[a]?!1:SaveSystem.unmarshal(b[a])},"delete":function(a){if(0>a||a>SaveSystem.maxIndex||!storage.hasItem("saves"))return!1;var b=storage.getItem("saves");if(a>b.length)return!1;b[a]=null;return storage.setItem("saves",b)},purge:function(){return storage.removeItem("saves")},exportSave:function(){if("function"!==typeof config.saves.isAllowed||config.saves.isAllowed()){var a=tale.domId+".json",b=JSON.stringify(SaveSystem.marshal());saveAs(new Blob([b],{type:"application/json;charset=UTF-8"}),a)}else window.alert("Saving is not allowed here.")},importSave:function(a){a=a.target.files[0];var b=new FileReader;b.onload=function(a){return function(a){if(a.target.result){var b;try{b=JSON.parse(a.target.result)}catch(c){}SaveSystem.unmarshal(b)}}}(a);b.readAsText(a)},marshal:function(){var a={mode:config.historyMode,id:config.saves.id};config.saves.version&&(a.version=config.saves.version);switch(config.historyMode){case modes.windowHistory:a.data=deepCopy(state.history);break;case modes.sessionHistory:a.data=deepCopy(state.history.slice(0,state.active.sidx+1));break;case modes.hashTag:a.data=state.active.hash}if("function"===typeof config.saves.onSave)config.saves.onSave(a);return a},unmarshal:function(a){if(!(a&&a.hasOwnProperty("mode")&&a.hasOwnProperty("id")&&a.hasOwnProperty("data")))return window.alert("Save is missing the required game data.  Either you've loaded a file which isn't a save, or the save has become corrupted.\n\nAborting load."),!1;if(a.mode!==config.historyMode)return window.alert("Save is from the wrong history mode.\n\nAborting load."),!1;if("function"===typeof config.saves.onLoad)config.saves.onLoad(a);if(a.id!==config.saves.id)return window.alert("Save is from the wrong story.\n\nAborting load."),!1;switch(config.historyMode){case modes.windowHistory:case modes.sessionHistory:document.title=tale.title;state=new History;config.historyMode===modes.sessionHistory&&state.regenerateSuid();for(var b=0,c=a.data.length;b<c;b++)state.history.push(deepCopy(a.data[b])),config.historyMode===modes.windowHistory?window.history.pushState(state.history,document.title):window.history.pushState({sidx:state.history[b].sidx,suid:state.suid},document.title);state.activate(state.top);state.display(state.active.title,null,"back");break;case modes.hashTag:window.location.hash=a.data}return!0}},MenuSystem={init:function(){function a(a,c){if(a&&a.hasChildNodes()){for(var d=a.childNodes,e=0;e<d.length;e++)if("a"==d[e].nodeName.toLowerCase()){d[e].onclick=c;return}a.onclick=c}}a(document.getElementById("saves"),MenuSystem.showSaves);a(document.getElementById("snapback"),MenuSystem.showSnapback);a(document.getElementById("restart"),MenuSystem.restart);a(document.getElementById("share"),MenuSystem.showShare)},hideAllMenus:function(){var a;if(a=document.getElementById("savesMenu"))a.style.display="none";if(a=document.getElementById("snapbackMenu"))a.style.display="none";if(a=document.getElementById("shareMenu"))a.style.display="none"},showMenu:function(a,b,c){a?c||(c=a.target):(a=window.event,c||(c=a.srcElement));var d=0,e=0;c=c.getBoundingClientRect();d=c.right+6;e=c.top-Math.floor((c.bottom-c.top)/2);b.style.top=e+"px";b.style.left=d+"px";b.style.display="block";document.onclick=MenuSystem.hideAllMenus;a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()},showSaves:function(a){var b=document.getElementById("savesMenu");MenuSystem.hideAllMenus();MenuSystem.buildSaves(b)&&MenuSystem.showMenu(a,b)},buildSaves:function(a){function b(a,b,c){var d=document.createElement("li"),e=document.createElement("button");e.id="savesMenu_"+a;e.innerHTML=b;e.onclick=c;d.appendChild(e);return d}function c(){function a(b,c,d,e){var f=document.createElement("button");f.id="savesMenu_"+b+d;f.classList.add(b);f.innerHTML=c;f.onclick=function(a){return function(){e(a)}}(d);return f}for(var b=storage.getItem("saves"),c=document.createElement("tbody"),d=0;d<b.length;d++){var e=document.createElement("tr"),n=document.createElement("td"),p=document.createElement("td"),r=document.createElement("td"),m=document.createElement("td");n.appendChild(document.createTextNode(d+1));var q;b[d]&&b[d].mode===config.historyMode?(q=a("load","Load",d,SaveSystem.load),p.appendChild(q),q=document.createTextNode(b[d].title),r.appendChild(q),q=a("delete","Delete",d,SaveSystem.delete),m.appendChild(q)):(q=a("save","Save",d,SaveSystem.save),p.appendChild(q),q=document.createElement("i"),q.innerHTML="(save slot empty)",r.appendChild(q),r.classList.add("emptySave"));e.appendChild(n);e.appendChild(p);e.appendChild(r);e.appendChild(m);c.appendChild(e)}b=document.createElement("table");b.id="savesMenu_list";b.appendChild(c);return b}var d,e=null!==storage.store;removeChildren(a);e&&(SaveSystem.init(),d=c(),d&&0!==d.length||(d=document.createElement("div"),d.id="savesMenu_list",d.innerHTML="<i>No save slots found</i>"),a.appendChild(d));if(e||config.hasFileAPI&&(!config.browser.isOpera||15<=config.browser.operaVersion))return d=document.createElement("ul"),config.hasFileAPI&&(!config.browser.isOpera||15<=config.browser.operaVersion)&&(d.appendChild(b("export","Save to Disk\u2026",SaveSystem.exportSave)),d.appendChild(b("import","Load from Disk\u2026",MenuSystem.showSavesImport))),e&&d.appendChild(b("purge","Purge Save Slots",SaveSystem.purge)),a.appendChild(d),!0;window.alert("Apologies!  Your browser either has none of the features required to support saves or has disabled them.\n\nThe former may be solved by updating it to a more recent version or by switching to a more modern browser.\n\nThe latter may be solved by loosening its security restrictions or, perhaps, by viewing the story via the HTTP protocol.");return!1},showSavesImport:function(a){var b=document.getElementById("savesMenu");MenuSystem.hideAllMenus();MenuSystem.buildSavesImport(b);MenuSystem.showMenu(a,b,document.getElementById("saves").getElementsByTagName("a")[0])},buildSavesImport:function(a){var b=document.createElement("div"),c=document.createElement("input");removeChildren(a);b.id="savesMenu_importLabel";b.appendChild(document.createTextNode("Select a save file to load:"));a.appendChild(b);c.type="file";c.id="savesMenu_importFile";c.name="savesMenu_importFile";c.onchange=SaveSystem.importSave;a.appendChild(c)},showSnapback:function(a){var b=document.getElementById("snapbackMenu");MenuSystem.hideAllMenus();MenuSystem.buildSnapback(b);MenuSystem.showMenu(a,b)},buildSnapback:function(a){var b=!1;removeChildren(a);for(var c=0,d=state.history.length-1;c<d;c++){var e=tale.get(state.history[c].title);e&&-1!==e.tags.indexOf("bookmark")&&(b=document.createElement("div"),b.onclick=function(){var a=c;return config.historyMode===modes.windowHistory?function(){document.title=tale.title;for(var b=0;b<=a;b++)window.history.pushState(state.history.slice(0,b+1),document.title);state.pop(state.history.length-(a+1));state.activate(state.top);state.display(state.active.title,null,"back")}:config.historyMode===modes.sessionHistory?function(){document.title=tale.title;state.regenerateSuid();for(var b=0;b<=a;b++)window.history.pushState({sidx:state.history[b].sidx,suid:state.suid},document.title);window.history.state.sidx<state.top.sidx&&state.pop(state.top.sidx-window.history.state.sidx);state.activate(state.top);state.display(state.active.title,null,"back")}:function(){window.location.hash=state.history[a].hash}}(),b.innerHTML=e.excerpt(),a.appendChild(b),b=!0)}b||(b=document.createElement("div"),b.innerHTML="<i>No passages available</i>",a.appendChild(b))},restart:function(){confirm("Are you sure you want to restart this story?")&&state.restart()},showShare:function(a){MenuSystem.hideAllMenus();MenuSystem.showMenu(a,document.getElementById("shareMenu"))}};function History(){this.active={init:!0,variables:{}};this.history=[]}History.prototype={get isEmpty(){return 0===this.history.length},get length(){return this.history.length},get top(){return 0!==this.history.length?this.history[this.history.length-1]:null}};History.prototype.index=function(a){return 0===this.history.length||0>a||a>=this.history.length?null:this.history[a]};History.prototype.peek=function(a){if(0===this.history.length)return null;a=1+(a?Math.abs(a):0);return a>this.history.length?null:this.history[this.history.length-a]};History.prototype.push=function(){if(0!==arguments.length)for(var a=0;a<arguments.length;a++){var b=arguments[a];config.historyMode===modes.sessionHistory&&(b.sidx=this.history.length);this.history.push(b)}};History.prototype.pop=function(a){if(0===this.history.length)return[];a=a?Math.abs(a):1;return 1==a?this.history.pop():this.history.splice(this.history.length-a,a)};History.prototype.activate=function(a){if("object"===typeof a){if(null===a)return null;this.active=deepCopy(a)}else{if(0===this.history.length||0>a||a>=this.history.length)return null;this.active=deepCopy(this.history[a])}return this.active};History.prototype.init=function(){this.restore()||this.display("Start");config.historyMode===modes.windowHistory?window.onpopstate=History.popStateHandler_windowHistory:config.historyMode===modes.sessionHistory?window.onpopstate=History.popStateHandler_sessionHistory:window.onhashchange=History.hashChangeHandler};History.prototype.display=function(a,b,c){a=tale.get(a);this.active.init&&!this.isEmpty&&(config.historyMode===modes.sessionHistory?this.activate(null!==window.history.state?window.history.state.sidx:this.top):this.activate(this.top));"back"!==c&&(config.historyMode===modes.sessionHistory&&(!this.isEmpty&&window.history.state.sidx<this.top.sidx)&&this.pop(this.top.sidx-window.history.state.sidx),this.push({title:a.title,variables:deepCopy(this.active.variables)}),this.activate(this.top),config.historyMode===modes.windowHistory?(null===window.history.state&&1!==this.history.length&&window.alert("!DANGER! (window.history.state === null) && (this.history.length !== 1) !DANGER!"),1===this.history.length&&null===window.history.state?window.history.replaceState(this.history,document.title):window.history.pushState(this.history,document.title)):config.historyMode===modes.sessionHistory&&(null===window.history.state?window.history.replaceState({sidx:this.active.sidx,suid:this.suid},document.title):window.history.pushState({sidx:this.active.sidx,suid:this.suid},document.title)));config.historyMode===modes.hashTag?this.active.hash=this.top.hash=this.save():config.historyMode===modes.sessionHistory&&this.save();if("offscreen"!==c&&(document.body.className&&(document.body.className=""),tale.has("PassageReady")))try{var d=document.createElement("div");for(new Wikifier(d,tale.get("PassageReady").text);d.hasChildNodes();){var e=d.firstChild;if(e.classList&&e.classList.contains("error"))throw Error(e.textContent);d.removeChild(e)}}catch(f){window.alert("There is a technical problem with this story (PassageReady: "+f.message+"). You may be able to continue reading, but all parts of the story may not work properly.")}var g=a.render();g.style.visibility="visible";"offscreen"!==c&&(c=document.getElementById("passages"),removeChildren(c),g.classList.add("transition-in"),setTimeout(function(){g.classList.remove("transition-in")},1),c.appendChild(g),config.displayPassageTitles&&"Start"!==a.title&&(document.title=tale.title+": "+a.title),config.historyMode===modes.hashTag&&(window.location.hash=this.hash=this.top.hash),window.scroll(0,0));return g};History.prototype.regenerateSuid=function(){session.removeItem("activeHistory");this.suid=generateUuid();this.save()};History.prototype.restart=function(){config.historyMode===modes.windowHistory?(window.history.pushState(null,document.title),window.location.reload()):config.historyMode===modes.sessionHistory?(session.removeItem("activeHistory"),window.location.reload()):window.location.hash=""};History.prototype.save=function(){if(config.historyMode===modes.sessionHistory)session.setItem("history."+this.suid,this.history)&&session.setItem("activeHistory",this.suid);else if(config.historyMode===modes.hashTag){for(var a="",b=0;b<this.history.length;b++){var c=tale.get(this.history[b].title);c&&"undefined"!==typeof c.id&&(a+=c.id.toString(36)+".")}return"#"+a.substr(0,a.length-1)}};History.prototype.restore=function(a){if(config.historyMode===modes.windowHistory){if(null!==window.history.state&&(this.history=window.history.state),!this.isEmpty&&tale.has(this.top.title))return this.display(this.top.title,null,"back"),!0}else if(config.historyMode===modes.sessionHistory){if(a?this.suid=a:null!==window.history.state&&session.hasItem("activeHistory")?this.suid=session.getItem("activeHistory"):this.suid=generateUuid(),this.suid&&session.hasItem("history."+this.suid)&&(this.history=session.getItem("history."+this.suid),tale.has(this.history[window.history.state.sidx].title)))return this.display(this.history[window.history.state.sidx].title,null,"back"),!0}else if(config.historyMode===modes.hashTag&&""!==window.location.hash&&"#"!==window.location.hash)try{var b=window.location.hash.replace("#","").split(".");a=0;for(var c=b.length-1;a<=c;a++){var d=parseInt(b[a],36);if(!tale.has(d))return!1;this.display(d,null,a===c?null:"offscreen")}return!0}catch(e){}return!1};History.hashChangeHandler=function(a){if(window.location.hash!==state.hash){if(""!==window.location.hash&&"#"!==window.location.hash){a=document.getElementById("passages");var b=storage.getItem("remember");state.active={init:!0,variables:null===b?{}:deepCopy(b)};state.history=[];a.style.visibility="hidden";removeChildren(a);state.restore()||window.alert("The passage you had previously visited could not be found.");a.style.visibility="visible"}else window.location.reload();state.hash=window.location.hash}};History.popStateHandler_windowHistory=function(a){if(null!==a.state){if(0===a.state.length)throw Error("Guru meditation error!");state.history=a.state;state.display(state.activate(state.top).title,null,"back")}};History.popStateHandler_sessionHistory=function(a){null!==a.state&&(a.state.suid!==state.suid&&(state.save(),state.restore(a.state.suid)),state.display(state.activate(a.state.sidx).title,null,"back"))};function Passage(a,b,c){this.title=a;if(b)if(this.id=c,this.domId="passage_"+slugify(this.title),this.text=Passage.unescapeLineBreaks(b.firstChild?b.firstChild.nodeValue:""),this.textExcerpt=Passage.getExcerptFromText(this.text),this.tags=b.hasAttribute("tags")?b.getAttribute("tags").trim():""){if(this.tags=this.tags.split(/\s+/),this.classes=[],this.className="",0<this.tags.length){a=/^(?:passage|stylesheet|script|widget|twine\.\w*)$/i;c=[];for(var d=0;d<this.tags.length;d++){var e=this.tags[d].toLowerCase();a.test(e)||c.push(slugify(e))}0<c.length&&(b.className&&(c=c.concat(b.className.split(/\s+/))),c.sort().filter(function(a,b,c){return 0==b||c[b-1]!=a?!0:!1}),this.classes=c,this.className=c.join(" "))}}else this.tags=[],this.classes=[],this.className="";else this.text='<html><span class="error">Error: this passage does not exist</span></html>',this.tags=[],this.classes=[],this.className=""}Passage.prototype.render=function(){var a=insertElement(null,"section",this.domId,"passage");a.style.visibility="hidden";for(var b=0,c=this.classes.length;b<c;b++)document.body.classList.add(this.classes[b]),a.classList.add(this.classes[b]);insertElement(a,"header","","header");b=insertElement(a,"div","","content");new Wikifier(b,this.text);insertElement(a,"footer","","footer");this.textExcerpt=Passage.getExcerptFromNode(b);return a};Passage.prototype.reset=function(){for(var a=document.getElementById("storeArea").childNodes,b=0;b<a.length;b++){var c=a[b],d;if(c.getAttribute&&(d=c.getAttribute("tiddler"))&&this.title==d){this.text=Passage.unescapeLineBreaks(c.firstChild?c.firstChild.nodeValue:"");return}}this.text='<html><span class="error">Error: this passage does not exist</span></html>'};Passage.prototype.excerpt=function(){return this.textExcerpt};Passage.getExcerptFromText=function(a,b){var c=RegExp("(\\S+(?:\\s+\\S+){0,"+("undefined"!=typeof b?b-1:7)+"})");return(c=a.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*)(?:|[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/\'{2}|\/{2}|_{2}|@{2}/g,"").replace(/\s+/g," ").trim().match(c))?c[1]+"\u2026":"\u2026"};Passage.getExcerptFromNode=function(a,b){function c(a){if(!a.hasChildNodes())return"";a=a.childNodes;for(var b="",d=0,e=a.length;d<e;d++)switch(a[d].nodeType){case 1:"none"!==a[d].style.display&&(b+=" ",a[d].hasChildNodes()&&(b+=c(a[d])));break;case 3:b+=a[d].textContent}return b}if(!a.hasChildNodes())return"";var d=RegExp("(\\S+(?:\\s+\\S+){0,"+("undefined"!=typeof b?b-1:7)+"})"),e=c(a).trim();e&&(e=e.replace(/\s+/g," ").match(d));return e?e[1]+"\u2026":"\u2026"};Passage.unescapeLineBreaks=function(a){return a&&""!=a?a.replace(/\\n/gm,"\n").replace(/\\s|\\/gm,"\\").replace(/\r/gm,""):""};Passage.mergeClassNames=function(){if(0==arguments.length)return"";for(var a=[],b=0;b<arguments.length;b++)"object"===typeof arguments[b]&&Array.isArray(arguments[b])?a=a.concat(arguments[b]):"string"===typeof arguments[b]&&(a=a.concat(arguments[b].split(/\s+/)));return 0<a.length?a.sort().filter(function(a,b,e){return 0==b||e[b-1]!=a?!0:!1}).join(" "):""};function Tale(){this.passages={};document.normalize&&document.normalize();for(var a=document.getElementById("storeArea").childNodes,b=0;b<a.length;b++){var c=a[b],d;c.getAttribute&&(d=c.getAttribute("tiddler"))&&(this.passages[d]=new Passage(d,c,b))}this.title=this.passages.StoryTitle?this.passages.StoryTitle.text:"Untitled Story";this.domId=slugify(this.title)}Tale.prototype.has=function(a){if("string"===typeof a)return void 0!==this.passages[a]&&null!==this.passages[a];if("number"===typeof a)for(var b in this.passages)if(this.passages[b].id===a)return!0;return!1};Tale.prototype.get=function(a){if("string"===typeof a)return this.passages[a]||new Passage(a);if("number"===typeof a)for(var b in this.passages)if(this.passages[b].id===a)return this.passages[b]};Tale.prototype.lookup=function(a,b,c){var d=[];c||(c="title");for(var e in this.passages)for(var f=this.passages[e],g=0;g<f[a].length;g++)f[a][g]==b&&d.push(f);d.sort(function(a,b){return a[c]==b[c]?0:a[c]<b[c]?-1:1});return d};Tale.prototype.reset=function(){for(var a in this.passages)this.passages[a].reset()};macros._children={};function registerMacroTags(a,b){if(!a)throw Error("no parent specified");b||(b=[]);b.push("/"+a,"end"+a);for(var c=0;c<b.length;c++){if(macros.hasOwnProperty(b[c]))throw Error("cannot register tag for existing macro");macros._children.hasOwnProperty(b[c])||(macros._children[b[c]]=a)}return b}function getContainerMacroData(a,b,c){for(var d="/"+b,e="end"+b,f=a.source.indexOf(">>",a.matchStart)+2,g=-1,h=f,k=f,l=1,n=b,p=a.rawArgs(),r=[];-1!==(h=a.source.indexOf("<<",k))&&-1!==(k=a.source.indexOf(">>",h));){var m=a.source.slice(h+2,k),q=m.search(/[\s\u00a0\u2028\u2029]/),w=-1===q?m:m.slice(0,q),k=k+2;switch(w){case b:l++;break;case e:case d:l--;break;default:if(1===l&&c)for(var x=0,C=c.length;x<C;x++)w===c[x]&&(r.push({name:n,arguments:p,contents:a.source.slice(f,h)}),n=w,p=-1===q?"":m.slice(q+1),f=k)}if(0===l){r.push({name:n,arguments:p,contents:a.source.slice(f,h)});g=h;break}}return-1!==g?(a.nextMatch=k,r):null}function evalMacroExpression(a,b,c){try{return eval(a),!0}catch(d){return throwError(b,"<<"+c+">>: bad expression: "+d.message),!1}}version.extensions.actionsMacro={major:1,minor:3,revision:0};macros.actions={handler:function(a,b,c){a=insertElement(a,"ul");a.className="actions";state.active.variables["#actions"]||(state.active.variables["#actions"]={});for(b=0;b<c.length;b++){var d,e,f=c[b].indexOf("|");-1===f?d=e=c[b]:(d=c[b].slice(0,f),e=c[b].slice(f+1));if(!state.active.variables["#actions"][e]){var f=insertElement(a,"li"),g=insertPassageLink(f,e,d);g.onclick=function(){var a=e,b=g;return function(){state.active.variables["#actions"][a]=!0;state.display(a,b)}}()}}}};version.extensions.backMacro=version.extensions.returnMacro={major:2,minor:1,revision:0};macros.back=macros["return"]={handler:function(a,b,c){var d=1,e,f="",g;if(0<c.length)if(1<c.length&&"steps"===c[1]){if(isNaN(c[0])||1>c[0]){throwError(a,"<<"+b+'>>: the parameter before "steps" must be a whole number greater than zero');return}d=c[0]<state.length?c[0]:state.length-1;e=state.peek(d).title;f=" ("+d+" steps)"}else{if(!tale.has(c[0])){throwError(a,"<<"+b+'>>: the "'+c[0]+'" passage does not exist');return}for(var h=state.history.length-1;0<=h;h--)if(state.history[h].title===c[0]){d=state.history.length-1-h;e=c[0];f=' (to "'+e+'")';break}}else 1<state.length&&(e=state.peek(d).title);e?(g=document.createElement("a"),g.classList.add(b+"Link"),0<d&&(g.onclick=function(){return"back"===b?config.historyMode===modes.hashTag?function(){for(;0<d;)state.isEmpty||state.pop(),d--;state.activate(state.top);state.display(e,g,"back")}:function(){1<state.length&&window.history.go(-d)}:function(){state.display(e,g)}}()),g.innerHTML="back"===b?this.backLabel||"<b>\u00ab</b> Back"+f:this.returnLabel||"<b>\u00ab</b> Return"+f,a.appendChild(g)):c[0]?throwError(a,"<<"+b+'>>: cannot find passage associated with "'+c[0]+(1<c.length&&"steps"===c[1]?" steps":"")+'"'):throwError(a,"<<"+b+">>: cannot find passage")},linktext:function(a,b,c){0===c.length?"back"===b?delete this.backLabel:delete this.returnLabel:"back"===b?this.backLabel=c[0]:this.returnLabel=c[0]}};version.extensions.bindMacro={major:1,minor:1,revision:0};macros.bind={children:registerMacroTags("bind"),handler:function(a,b,c,d){if(0===c.length)throwError(a,"<<"+b+">>: no link text specified");else if(d=getContainerMacroData(d,b)){var e=c[0],f=1<c.length?c[1]:void 0,g=document.createElement("a");g.classList.add(b+"Link");g.classList.add(f?tale.has(f)?"internalLink":"brokenLink":"internalLink");g.innerHTML=e;g.onclick=function(a){return function(){""!==a&&new Wikifier(document.createElement("div"),a);void 0!==f&&state.display(f,g)}}(d[0].contents.trim());a.appendChild(g)}else throwError(a,"<<"+b+">>: cannot find a matching close tag")}};version.extensions.choiceMacro={major:1,minor:0,revision:1};macros.choice={handler:function(a,b,c){if(0===c.length)throwError(a,"<<"+b+">>: no passage specified");else{var d=insertPassageLink(a,c[0],c[0],b+"Link");d.onclick=function(){state.display(c[0],d)}}}};version.extensions.classMacro={major:2,minor:1,revision:0};macros["class"]={children:registerMacroTags("class"),handler:function(a,b,c,d){(d=getContainerMacroData(d,b))?(a=insertElement(a,c[1]||"span",null,c[0]||""),new Wikifier(a,d[0].contents)):throwError(a,"<<"+b+">>: cannot find a matching close tag")}};version.extensions.classupdateMacro={major:1,minor:0,revision:0};macros.classupdate={handler:function(a,b,c,d){if(3>c.length)d=[],1>c.length&&d.push("element ID"),2>c.length&&d.push("action"),3>c.length&&d.push("class names"),throwError(a,"<<"+b+">>: no "+d.join(" or ")+" specified");else{d="body"===c[0]?document.body:document.getElementById(c[0]);var e=c[1],f=c[2].trim().split(/\s+/);if(d)if("add"!==e&&"remove"!==e&&"toggle"!==e)throwError(a,"<<"+b+'>>: "'+e+'" is not a valid action (add|remove|toggle)');else for(a=0;a<f.length;a++)switch(e){case "add":d.classList.add(f[a]);break;case "remove":d.classList.remove(f[a]);break;case "toggle":d.classList.toggle(f[a])}else throwError(a,"<<"+b+'>>: element with ID "'+c[0]+'" does not exist')}}};version.extensions.displayMacro={major:2,minor:1,revision:0};macros.display={handler:function(a,b,c,d){0===c.length?throwError(a,"<<"+b+">>: no passage specified"):tale.has(c[0])?(b=tale.get(c[0]),c[1]?new Wikifier(insertElement(a,c[1],null,b.domId),b.text):new Wikifier(a,b.text)):throwError(a,"<<"+b+'>>: passage "'+c[0]+'" does not exist')}};version.extensions.idMacro={major:2,minor:1,revision:0};macros.id={children:registerMacroTags("id"),handler:function(a,b,c,d){(d=getContainerMacroData(d,b))?(a=insertElement(a,c[1]||"span",c[0]||""),new Wikifier(a,d[0].contents)):throwError(a,"<<"+b+">>: cannot find a matching close tag")}};version.extensions.ifMacro={major:2,minor:1,revision:0};macros["if"]={excludeParams:!0,children:registerMacroTags("if",["elseif","else"]),handler:function(a,b,c,d){if(c=getContainerMacroData(d,b,["else"+b,"else"]))try{d=0;for(var e=c.length;d<e;d++)if("else"===c[d].name||eval(Wikifier.parse(c[d].arguments))){new Wikifier(a,c[d].contents);break}}catch(f){throwError(a,"<<"+b+">>: bad conditional expression: "+f.message)}else throwError(a,"<<"+b+">>: cannot find a matching close tag")}};version.extensions.linkMacro={major:1,minor:0,revision:0};macros.link={handler:function(a,b,c){function d(a,c,d){var e=insertPassageLink(a,c,d,b+"Link");e.onclick=function(){h&&(state.active.variables["#link"][c]=!0);state.display(c,e)};return e}function e(a,c,d){a=insertElement(a,"a",null,"externalLink "+b+"Link",d);a.href=c;a.target="_blank";return a}if(0===c.length)throwError(a,"<<"+b+">>: no link location specified");else{var f=c[0],g,h;1===c.length?g=c[0]:2===c.length?"once"===c[1]||"keep"===c[1]?(g=c[0],h=c[1]):g=c[1]:3===c.length&&(g=c[1],h=c[2]);if(h&&"once"!==h&&"keep"!==h)throwError(a,"<<"+b+'>>: "'+h+'" is not a valid action (once|keep)');else{if(h)if(!state.active.variables.hasOwnProperty("#link"))state.active.variables["#link"]={};else if(state.active.variables["#link"][g]){"keep"===h&&insertText(a,f);return}1===c.length?d(a,g,f):tale.has(g)?d(a,g,f):e(a,g,f)}}}};version.extensions.printMacro={major:1,minor:2,revision:0};macros.print={excludeParams:!0,handler:function(a,b,c,d){try{var e=eval(d.fullArgs());null==e||"number"===typeof e&&isNaN(e)||new Wikifier(a,e.toString())}catch(f){throwError(a,"<<"+b+">>: bad expression: "+f.message)}}};version.extensions.rememberMacro={major:2,minor:1,revision:0};macros.remember={excludeParams:!0,handler:function(a,b,c,d){c=d.fullArgs();if(evalMacroExpression(c,a,b)){for(var e=storage.getItem("remember")||{},f=/state\.active\.variables\.(\w+)/g,g;null!==(g=f.exec(c));)g=g[1],e[g]=state.active.variables[g];storage.setItem("remember",e)||throwError(a,"<<"+b+">>: unknown error, cannot remember: "+d.rawArgs())}},init:function(){var a=storage.getItem("remember");if(null!==a)for(var b in a)state.active.variables[b]=a[b]}};version.extensions.runMacro=version.extensions.runjsMacro=version.extensions.setMacro={major:2,minor:1,revision:0};macros.run=macros.runjs=macros.set={excludeParams:!0,handler:function(a,b,c,d){evalMacroExpression("runjs"===b?d.rawArgs():d.fullArgs(),a,b)},run:function(a,b,c){return evalMacroExpression(a,b,c)}};version.extensions.silentlyMacro={major:2,minor:1,revision:0};macros.silently={excludeParams:!0,children:registerMacroTags("silently"),handler:function(a,b,c,d){(c=getContainerMacroData(d,b))?new Wikifier(document.createElement("div"),c[0].contents.trim()):throwError(a,"<<"+b+">>: cannot find a matching close tag")}};version.extensions.unsetMacro={major:1,minor:0,revision:0};macros.unset={excludeParams:!0,handler:function(a,b,c,d){c=d.fullArgs();d=/state\.active\.variables\.(\w+)/g;for(var e,f=storage.getItem("remember"),g=!1;null!==(e=d.exec(c));)e=e[1],state.active.variables.hasOwnProperty(e)&&delete state.active.variables[e],f&&f.hasOwnProperty(e)&&(g=!0,delete f[e]);g&&!storage.setItem("remember",f)&&throwError(a,"<<"+b+">>: unknown error, cannot update remember store")}};version.extensions.updateMacro={major:1,minor:1,revision:0};macros.update={children:registerMacroTags("update"),handler:function(a,b,c,d){if(0===c.length)throwError(a,"<<"+b+">>: no element ID specified");else if(d=getContainerMacroData(d,b)){var e=document.getElementById(c[0]),f=c[1];if(e)if(f&&"append"!==f&&"prepend"!==f&&"replace"!==f)throwError(a,"<<"+b+'>>: "'+f+'" is not a valid action (append|prepend|replace)');else{switch(f){case "prepend":a=document.createElement("span");e.insertBefore(a,e.firstChild);break;case "append":a=e;break;default:a=e,removeChildren(a)}new Wikifier(a,d[0].contents)}else throwError(a,"<<"+b+'>>: element with ID "'+c[0]+'" does not exist')}else throwError(a,"<<"+b+">>: cannot find a matching close tag")}};version.extensions.widgetMacro={major:1,minor:1,revision:0};macros.widget={children:registerMacroTags("widget"),handler:function(a,b,c,d){if(0===c.length)throwError(a,"<<"+b+">>: no widget name specified");else{c=c[0];if(macros[c]){if(!macros[c].isWidget){throwError(a,"<<"+b+'>>: cannot clobber existing macro "'+c+'"');return}delete macros[c];delete version.extensions[c+"WidgetMacro"]}if(d=getContainerMacroData(d,b))try{macros[c]={isWidget:!0,handler:function(a){return function(b,c,d,e){state.active.variables.hasOwnProperty("args")&&(state.active.variables.hasOwnProperty("#widget-args")||(state.active.variables["#widget-args"]=[]),state.active.variables["#widget-args"].push(state.active.variables.args));state.active.variables.args=[];state.active.variables.args[0]=e.fullArgs();e=0;for(var n=d.length;e<n;e++)state.active.variables.args[e+1]=d[e];try{new Wikifier(b,a)}catch(p){throwError(b,"<<"+c+">>: cannot execute widget: "+p.message)}delete state.active.variables.args;state.active.variables.hasOwnProperty("#widget-args")&&(state.active.variables.args=state.active.variables["#widget-args"].pop(),0===state.active.variables["#widget-args"].length&&delete state.active.variables["#widget-args"])}}(d[0].contents)},version.extensions[c+"WidgetMacro"]={major:1,minor:0,revision:0}}catch(e){throwError(a,"<<"+b+'>>: cannot create widget macro "'+c+'": '+e.message)}else throwError(a,"<<"+b+">>: cannot find a matching close tag")}}};String.prototype.readMacroParams=function(a){var b=RegExp("(?:(?:\"((?:(?:\\\\\")|[^\"])+)\")|(?:'((?:(?:\\\\')|[^'])+)')|(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)|((?:\"\")|(?:'')))","gm"),c=[];do{var d=b.exec(this);if(d){var e;if(d[1])e=d[1];else if(d[2])e=d[2];else if(d[3])e=d[3];else if(d[4])if(e=d[4],a&&/\$/.test(e))for(var f=/\$(\w+)((?:\.\w+|\[[^\]]+\])*)/g,g=e,h;null!==(h=f.exec(g));){var g=h[0],k=h[1];if("undefined"!==typeof state.active.variables[k])if(h[2])try{var l=eval(g.replace(/\$/g,"state.active.variables."));e=e.replace(g,l)}catch(n){}else e=e.replace(g,state.active.variables[k])}else isNumeric(e)?e=Number(e):isBoolean(e)&&(e="true"===e?!0:!1);else d[5]&&(e="");c.push(e)}}while(d);return c};String.prototype.unDash=function(){var a,b=this.split("-");if(1<b.length)for(a=1;a<b.length;a++)b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1);return b.join("")};function WikiFormatter(a){this.formatters=[];for(var b=[],c=0;c<a.length;c++)b.push("("+a[c].match+")"),this.formatters.push(a[c]);this.formatterRegExp=RegExp(b.join("|"),"gm")}function Wikifier(a,b){this.source=b;this.output=a;this.nextMatch=0;this.formatter=formatter;this.subWikify(this.output)}Wikifier.prototype.subWikify=function(a,b){var c=this.output;this.output=a;var d=b?RegExp("("+b+")","gm"):null;do{this.formatter.formatterRegExp.lastIndex=this.nextMatch;d&&(d.lastIndex=this.nextMatch);var e=this.formatter.formatterRegExp.exec(this.source),f=d?d.exec(this.source):null;if(f&&(!e||f.index<=e.index)){f.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,f.index);this.matchStart=f.index;this.matchLength=f[1].length;this.matchText=f[1];this.nextMatch=f.index+f[1].length;this.output=c;return}if(e){e.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,e.index);this.matchStart=e.index;this.matchLength=e[0].length;this.matchText=e[0];this.nextMatch=this.formatter.formatterRegExp.lastIndex;for(var g=-1,h=1;h<e.length;h++)e[h]&&(g=h-1);-1!=g&&this.formatter.formatters[g].handler(this)}}while(f||e);this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length);this.output=c};Wikifier.prototype.outputText=function(a,b,c){insertText(a,this.source.substring(b,c))};Wikifier.prototype.rawArgs=function(){var a=this.source.indexOf(">>",this.matchStart),b=this.source.slice(this.matchStart+2,a).search(/[\s\u00a0\u2028\u2029]/);return-1===b?"":this.source.slice(this.matchStart+b+3,a)};Wikifier.prototype.fullArgs=function(){return Wikifier.parse(this.rawArgs())};Wikifier.parse=function(a){for(var b=RegExp("(?:(?:\"((?:(?:\\\\\")|[^\"])+)\")|(?:'((?:(?:\\\\')|[^'])+)')|((?:\"\")|(?:''))|([=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)|([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+))","g"),c,d={$:"state.active.variables.",def:'"undefined" !== typeof',ndef:'"undefined" === typeof',eq:"==",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",to:"="};null!==(c=b.exec(a));)if(c[5]){var e=c[5];"$"===e[0]&&(e="$");d[e]&&(a=a.splice(c.index,e.length,d[e]),b.lastIndex+=d[e].length-e.length)}return a};Wikifier.formatterHelpers={charFormatHelper:function(a){var b=insertElement(a.output,this.element);a.subWikify(b,this.terminator)},inlineCssHelper:function(a){var b=[],c=RegExp("(?:("+Wikifier.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+Wikifier.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)","gm");do{c.lastIndex=a.nextMatch;var d=c.exec(a.source),e=d&&d.index==a.nextMatch;if(e){var f,g;d[1]?(f=d[1].unDash(),g=d[2]):(f=d[3].unDash(),g=d[4]);switch(f){case "bgcolor":f="backgroundColor";break;case "float":f="cssFloat"}b.push({style:f,value:g});a.nextMatch=d.index+d[0].length}}while(e);return b},monospacedByLineHelper:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;if((b=b.exec(a.source))&&b.index===a.matchStart){var c=b[1];config.browser.isIE&&10>config.browser.ieVersion&&(c=c.replace(/\n/g,"\r"));insertElement(a.output,"pre",null,null,c);a.nextMatch=b.index+b[0].length}}};Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:"^\\|([^\\n]*)\\|([fhck]?)$",rowTerminator:"\\|(?:[fhck]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhck]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{c:"caption",h:"thead","":"tbody",f:"tfoot"},handler:function(a){var b=insertElement(a.output,"table"),c=RegExp(this.lookahead,"gm"),d=null,e,f,g=[],h=0;a.nextMatch=a.matchStart;do{c.lastIndex=a.nextMatch;var k=c.exec(a.source),l=k&&k.index===a.nextMatch;l&&(e=k[2],"k"===e?(b.className=k[1],a.nextMatch+=k[0].length+1):(e!==d&&(f=insertElement(b,this.rowTypes[e])),d=e,"c"===d?(0===h?f.setAttribute("align","top"):f.setAttribute("align","bottom"),a.nextMatch+=1,a.subWikify(f,this.rowTerminator)):(e=insertElement(f,"tr"),this.rowHandler(a,e,g)),h++))}while(l)},rowHandler:function(a,b,c){var d=0,e=1,f=RegExp(this.cellPattern,"gm");do{f.lastIndex=a.nextMatch;var g=f.exec(a.source),h=g&&g.index===a.nextMatch;if(h){if("~"===g[1]){var k=c[d];k&&(k.rowCount++,k.element.setAttribute("rowSpan",k.rowCount),k.element.setAttribute("rowspan",k.rowCount),k.element.valign="center");a.nextMatch=g.index+g[0].length-1}else if(">"===g[1])e++,a.nextMatch=g.index+g[0].length-1;else if(g[2]){a.nextMatch=g.index+g[0].length;break}else{var k=g=!1,l;a.nextMatch++;for(var n=Wikifier.formatterHelpers.inlineCssHelper(a);" "===a.source.substr(a.nextMatch,1);)g=!0,a.nextMatch++;"!"===a.source.substr(a.nextMatch,1)?(l=insertElement(b,"th"),a.nextMatch++):l=insertElement(b,"td");c[d]={rowCount:1,element:l};1<e&&(l.setAttribute("colSpan",e),l.setAttribute("colspan",e),e=1);for(var p=0;p<n.length;p++)l.style[n[p].style]=n[p].value;a.subWikify(l,this.cellTerminator);" "===a.matchText.substr(a.matchText.length-2,1)&&(k=!0);g&&k?l.align="center":g?l.align="right":k&&(l.align="left");a.nextMatch-=1}d++}}while(h)}},{name:"heading",match:"^!{1,6}",terminator:"\\n",handler:function(a){a.subWikify(insertElement(a.output,"h"+a.matchLength),this.terminator)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",outerElement:"ul",itemElement:"li",handler:function(a){var b=RegExp(this.lookahead,"gm");a.nextMatch=a.matchStart;var c=[a.output],d=null,e,f=0,g;do{b.lastIndex=a.nextMatch;var h=b.exec(a.source),k=h&&h.index==a.nextMatch;if(k){e=h[2]?"ol":"ul";g=h[0].length;a.nextMatch+=h[0].length;if(g>f)for(d=f;d<g;d++)c.push(insertElement(c[c.length-1],e));else if(g<f)for(d=f;d>g;d--)c.pop();else g==f&&e!=d&&(c.pop(),c.push(insertElement(c[c.length-1],e)));f=g;d=e;e=insertElement(c[c.length-1],"li");a.subWikify(e,this.terminator)}}while(k)}},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(a){var b=insertElement(a.output,"blockquote");a.subWikify(b,this.terminator)}},{name:"quoteByLine",match:"^>+",terminator:"\\n",element:"blockquote",handler:function(a){var b=RegExp(this.match,"gm"),c=[a.output],d=0,e=a.matchLength;do{if(e>d)for(;d<e;d++)c.push(insertElement(c[c.length-1],this.element));else if(e<d)for(;d>e;d--)c.pop();d=e;a.subWikify(c[c.length-1],this.terminator);insertElement(c[c.length-1],"br");b.lastIndex=a.nextMatch;var f=b.exec(a.source),g=f&&f.index==a.nextMatch;g&&(e=f[0].length,a.nextMatch+=f[0].length)}while(g)}},{name:"rule",match:"^----+$\\n?|<hr ?/?>\\n?",handler:function(a){insertElement(a.output,"hr")}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatterHelpers.monospacedByLineHelper},{name:"monospacedByLineForPlugin",match:"^//\\{\\{\\{\\n",lookahead:"^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",handler:Wikifier.formatterHelpers.monospacedByLineHelper},{name:"wikifyCommentForPlugin",match:"^/\\*\\*\\*\\n",terminator:"^\\*\\*\\*/\\n",handler:function(a){a.subWikify(a.output,this.terminator)}},{name:"prettyLink",match:"\\[\\[",lookahead:"\\[\\[([^\\|\\]]*?)(?:(\\]\\])|(\\|(.*?)\\]\\]))",terminator:"\\|",handler:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;var b=b.exec(a.source),c;b&&b.index===a.matchStart&&(b[2]?(c=Wikifier.createInternalLink(a.output,b[1]),a.outputText(c,a.nextMatch,a.nextMatch+b[1].length),a.nextMatch+=b[1].length+2):b[3]&&(c=tale.has(b[4])?Wikifier.createInternalLink(a.output,b[4]):Wikifier.createExternalLink(a.output,b[4]),a.outputText(c,a.nextMatch,a.nextMatch+b[1].length),a.nextMatch=b.index+b[0].length))}},{name:"urlLink",match:"(?:http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)",handler:function(a){var b=Wikifier.createExternalLink(a.output,a.matchText);a.outputText(b,a.matchStart,a.nextMatch)}},{name:"image",match:"\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",lookahead:"\\[([<]{0,1})([>]{0,1})[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",handler:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;if((b=b.exec(a.source))&&b.index===a.matchStart){var c=a.output;b[5]&&(c=tale.has(b[5])?Wikifier.createInternalLink(a.output,b[5]):Wikifier.createExternalLink(a.output,b[5]));c=insertElement(c,"img");b[1]?c.align="left":b[2]&&(c.align="right");b[3]&&(c.title=b[3]);c.src=b[4];a.nextMatch=b.index+b[0].length}}},{name:"macro",match:"<<",lookahead:"<<([^>\\s]+)(?:\\s*)((?:[^>]|(?:>(?!>)))*)>>",handler:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;if((b=b.exec(a.source))&&b.index===a.matchStart&&b[1]){a.nextMatch=b.index+b[0].length;var c=b[1],d="handler",e=c.indexOf("::");-1!==e&&(d=c.slice(e+2),c=c.slice(0,e));try{var f=macros[c];f?"function"===typeof f[d]?(e=[],f.excludeParams||(e=b[2].readMacroParams(void 0!==f.replaceVarParams?f.replaceVarParams:!0)),f[d](a.output,c,e,a)):throwError(a.output,"macro <<"+c+'>> property "'+d+'" '+(f.hasOwnProperty(d)?"is not a function":"does not exist")):macros._children.hasOwnProperty(c)?throwError(a.output,"macro <<"+c+">> was found outside of a call to its parent <<"+macros._children[c]+">>"):throwError(a.output,"macro <<"+c+">> does not exist")}catch(g){throwError(a.output,"cannot execute "+(f&&f.isWidget?"widget":"macro")+" <<"+c+">>: "+g.message)}}}},{name:"html",match:"<[Hh][Tt][Mm][Ll]>",lookahead:"<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)</[Hh][Tt][Mm][Ll]>",handler:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;(b=b.exec(a.source))&&b.index===a.matchStart&&(insertElement(a.output,"span").innerHTML=b[1],a.nextMatch=b.index+b[0].length)}},{name:"commentByBlock",match:"/%",lookahead:"/%((?:.|\\n)*?)%/",handler:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;(b=b.exec(a.source))&&b.index===a.matchStart&&(a.nextMatch=b.index+b[0].length)}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatterHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(a){var b=RegExp(this.lookahead,"gm");b.lastIndex=a.matchStart;(b=b.exec(a.source))&&b.index===a.matchStart&&(insertElement(a.output,"code",null,null,b[1]),a.nextMatch=b.index+b[0].length)}},{name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",handler:function(a){var b=insertElement(a.output,"span",null,null,null),c=Wikifier.formatterHelpers.inlineCssHelper(a);if(0==c.length)b.className="marked";else for(var d=0;d<c.length;d++)b.style[c[d].style]=c[d].value;a.subWikify(b,this.terminator)}},{name:"emdash",match:"--",handler:function(a){insertElement(a.output,"span").innerHTML="\u2014"}},{name:"lineContinuation",match:"\\\\[\\s\\u00a0\\u2028\\u2029]*?(?:\\n|$)",handler:function(a){a.nextMatch=a.matchStart+a.matchLength}},{name:"lineBreak",match:"\\n|<br ?/?>",handler:function(a){insertElement(a.output,"br")}},{name:"rawText",match:'"{3}|<nowiki>',lookaheadRegExp:/(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,handler:function(a){this.lookaheadRegExp.lastIndex=a.matchStart;var b=this.lookaheadRegExp.exec(a.source);b&&b.index===a.matchStart&&(insertElement(a.output,"span",null,null,b[1]),a.nextMatch=this.lookaheadRegExp.lastIndex)}}];Wikifier.createInternalLink=function(a,b,c){var d=insertPassageLink(a,b,c);d.onclick=function(){state.display(b,d)};return d};Wikifier.createExternalLink=function(a,b,c){a=insertElement(a,"a",null,"externalLink",c);a.href=b;a.target="_blank";return a};Wikifier.textPrimitives={};/[\u0150\u0170]/g.test("\u0150")?Wikifier.textPrimitives.anyLetter="[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]":Wikifier.textPrimitives.anyLetter="[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-]";}());
</script>
<style type="text/css">
body { margin: 3.5em 15% 5% 3.5em; color: #fff; background-color: #111; font-family: verdana,"dejavu sans",tahoma,arial,sans-serif; font-size: 12px; }
a { cursor: pointer; color: #46d; }
a:hover { color: #8af; }
a:active { color: #f70; }
a.internalLink, a.externalLink, a.backLink, a.returnLink { font-weight: bold; text-decoration: none; }
a.internalLink:hover, a.externalLink:hover, a.backLink:hover, a.returnLink:hover { text-decoration: underline; }
a.brokenLink { padding: 3px; color: #000; background-color: red; font-weight: bold; text-decoration: none; }
input, textarea { min-width: 16em; color: #fff; background-color: #444; border: 1px solid #fff; }
input:focus, textarea:focus { border: 1px solid #292; }
input:hover, textarea:hover { border: 1px solid #f70; }
noscript { color: red; font-size: 210%; font-weight: bold; }
.error { margin: 0 12px 0 3px; padding: 3px 5px; color: #000; background-color: red; font-weight: bold; }

#sidebar { position: fixed; top: 3.5em; left: 3.5em; width: 14.5em; margin: 0; padding: 0 1.5em 0 0; border-right: 1px solid #fff; }
#sidebar header, #sidebar nav, #sidebar footer { text-align: right; }
#sidebar header, #sidebar nav { font-weight: bold; }
#sidebar nav, #sidebar footer { margin-top: 3em; }
#sidebar ul { list-style: none; }
#sidebar li { margin-bottom: 1em; }
#sidebar li a { text-decoration: none; }

#storyTitle { margin: 0; font-size: 210%; }
#storySubtitle { font-size: 111%; }
#storyAuthor { font-size: 111%; }
#storyCaption { display: none; margin-top: 3em; text-align: right; }
#storyMenu, #shareMenu, #share { display: none; }
#storyMenu { line-height: 1.2; }

#credits, #version { margin-top: 1em; color: #999; font-weight: normal; font-size: 71%; }

/* Default pop menu styling */
.menu
{
	position: fixed;
	display: none;
	color: #fff;
	background-color: #333;
	border: 1px solid #fff;
	text-align: left;
	line-height: 2;
}
.menu div
{
	padding: 0.2em;
}

/* Default pop menu button styling */
.menu button
{
	cursor: pointer;
	padding: 2px 3px;
	color: #fff;
	background-color: #259;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
	border: 1px solid #147;
	text-decoration: none;
	text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.4);
	-webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4), 0 1px 1px rgba(0, 0, 0, 0.2);
	-moz-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4), 0 1px 1px rgba(0, 0, 0, 0.2);
	box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4), 0 1px 1px rgba(0, 0, 0, 0.2);
	-webkit-transition-duration: 0.2s;
	-moz-transition-duration: 0.2s;
	transition-duration: 0.2s;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
}
.menu button:hover
{
	background-color: #47b;
	border: 1px solid #369;
}
.menu button:active
{
	-webkit-box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.6);
	-moz-box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.6);
	box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.6);
	background-color: #f70;
	border: 1px solid #d60;
}

/* Saves pop menu styling */
#savesMenu_list
{
	border-spacing: 0;
	border-bottom: 1px solid #fff;
	min-width: 320px;
	width: 100%;
}
#savesMenu_list tr:nth-child(even)
{
	background-color: #444;
}
#savesMenu_list td
{
	padding: 0.1em 0.3em 0.2em;
}
#savesMenu_list td:first-child
{
	min-width: 1.5em;
	text-align: center;
}
#savesMenu_list .emptySave
{
	color: #999;
}
#savesMenu_list button.load, #savesMenu_import
{
	background-color: #292;
	border: 1px solid #171;
}
#savesMenu_list button.load:hover, #savesMenu_import:hover
{
	background-color: #4b4;
	border: 1px solid #393;
}
#savesMenu_list button.load:active, #savesMenu_import:active
{
	background-color: #f70;
	border: 1px solid #d60;
}
#savesMenu ul { display: block; margin: 0; padding: 0; list-style: none; }
#savesMenu li { display: inline-block; margin: 0; padding: 0.4em 0.4em 0.5em; }
#savesMenu_importLabel { margin: 0 6px; font-weight: bold; }
#savesMenu_importFile { margin: 0 6px 6px; }

/* Rewind & Share pop menu styling */
#shareMenu a { display: block; color: #fff; font-weight: normal; text-decoration: none; }
#snapbackMenu div, #shareMenu div, #shareMenu a
{
	padding: 0.15em 0.75em;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
}
#snapbackMenu div:nth-child(even), #shareMenu div:nth-child(even), #shareMenu a:nth-child(even)
{
	background-color: #444;
}
#snapbackMenu div:hover, #shareMenu div:hover, #shareMenu a:hover
{
	cursor: pointer;
	color: #fff;
	background-color: #47b;
}
#snapbackMenu div:active, #shareMenu div:active, #shareMenu a:active
{
	background-color: #47b;
}

#passages { margin-left: 16em; padding-left: 1.5em; border-left: 1px solid #fff; }
.passage { line-height: 1.75; margin-bottom: 2em; text-align: left; }
.passage ul.actions { list-style: none; padding-top: 1.3em; text-align: center; }
.passage .actions > ul { list-style: none; text-align: center; }
.passage .actions li { display: inline; margin-right: 6em; }
.highlight, .marked { color: yellow; font-weight: bold; font-style: italic; }
.passage ul { margin-left: 0.5em; padding-left: 1.5em; }
.passage ol { margin-left: 0.5em; padding-left: 1.5em; }
.passage table { margin: 0.8em 1.0em; border-collapse: collapse; font-size: 100%; }
.passage th, .passage td, .passage tr, .passage caption { padding: 3px; }
.passage hr { height: 1px; border: none; background-color: #fff; }

#storeArea { display: none; }

.transition-in { opacity: 0; }
.passage:not(.transition-out) { transition: opacity 400ms ease-in; -webkit-transition: opacity 400ms ease-in; }
/*.transition-out { opacity: 0; position: absolute; }*/
</style>
</head>
<body id="body">
	<div id="sidebar">
		<header id="title">
			<div id="storyBanner"></div>
			<h1 id="storyTitle"></h1>
			<div id="storySubtitle"></div>
			<p id="storyAuthor"></p>
		</header>
		<div id="storyCaption"></div>
		<nav>
			<ul id="menu">
				<li id="storyMenu"></li>
				<li id="saves"><a>Saves</a></li>
				<li id="snapback"><a>Rewind</a></li>
				<li id="restart"><a>Restart</a></li>
				<li id="share"><a>Share</a></li>
			</ul>
		</nav>
		<footer>
			<p id="credits">This story was created with <a href="http://gimcrackd.com/etc/src/">Twine</a> and is powered by <a href="http://www.motoslave.net/sugarcube/">SugarCube</a>, which is based on <a href="http://tiddlywiki.com/">TiddlyWiki</a></p>
			<p id="version">SugarCube (&#x03b2;-1913)</p>
		</footer>

		<!-- pop menu targets -->
		<div id="savesMenu" class="menu"></div>
		<div id="snapbackMenu" class="menu"></div>
		<div id="shareMenu" class="menu"></div>
	</div>

	<div role="main" id="passages"><noscript>Please enable JavaScript to play this story!</noscript></div>

	<div id="storeArea">